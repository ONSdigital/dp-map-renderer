package api

// TODO remove spike code

import (
	"github.com/rubenv/topojson"
	"io/ioutil"
	"io"
	"github.com/ONSdigital/go-ns/log"
	"github.com/fapian/geojson2svg/pkg/geojson2svg"
	"github.com/paulmach/go.geojson"
)

var placesJson, _ = geojson.UnmarshalFeatureCollection([]byte(`{
"type": "FeatureCollection",
"features": [
{ "type": "Feature", "properties": { "SCALERANK": 6, "NATSCALE": 30, "LABELRANK": 5, "FEATURECLA": "Admin-0 region capital", "NAME": "Edinburgh", "NAMEPAR": null, "NAMEALT": null, "DIFFASCII": 0, "NAMEASCII": "Edinburgh", "ADM0CAP": 0.000000, "CAPIN": null, "WORLDCITY": 0.000000, "MEGACITY": 0, "SOV0NAME": "United Kingdom", "SOV_A3": "GBR", "ADM0NAME": "United Kingdom", "ADM0_A3": "GBR", "ADM1NAME": "Edinburgh", "ISO_A2": "GB", "NOTE": null, "LATITUDE": 55.948328, "LONGITUDE": -3.219091, "CHANGED": 1.000000, "NAMEDIFF": 0, "DIFFNOTE": "Changed scale rank.", "POP_MAX": 504966, "POP_MIN": 435791, "POP_OTHER": 442794, "RANK_MAX": 11, "RANK_MIN": 10, "GEONAMEID": 2650225.000000, "MEGANAME": null, "LS_NAME": "Edinburgh", "LS_MATCH": 1, "CHECKME": 0, "MAX_POP10": 504966.000000, "MAX_POP20": 504966.000000, "MAX_POP50": 0.000000, "MAX_POP300": 0.000000, "MAX_POP310": 0.000000, "MAX_NATSCA": 20.000000, "MIN_AREAKM": 175.000000, "MAX_AREAKM": 175.000000, "MIN_AREAMI": 68.000000, "MAX_AREAMI": 68.000000, "MIN_PERKM": 194.000000, "MAX_PERKM": 194.000000, "MIN_PERMI": 121.000000, "MAX_PERMI": 121.000000, "MIN_BBXMIN": -3.358333, "MAX_BBXMIN": -3.358333, "MIN_BBXMAX": -3.008333, "MAX_BBXMAX": -3.008333, "MIN_BBYMIN": 55.833333, "MAX_BBYMIN": 55.833333, "MIN_BBYMAX": 55.983333, "MAX_BBYMAX": 55.983333, "MEAN_BBXC": -3.180847, "MEAN_BBYC": 55.922399, "COMPARE": 0, "GN_ASCII": "Edinburgh", "FEATURE_CL": "P", "FEATURE_CO": "PPLA", "ADMIN1_COD": 0.000000, "GN_POP": 435791.000000, "ELEVATION": 0.000000, "GTOPO30": 32.000000, "TIMEZONE": "Europe\/London", "GEONAMESNO": "GeoNames match general.", "UN_FID": 0, "UN_ADM0": null, "UN_LAT": 0.000000, "UN_LONG": 0.000000, "POP1950": 0.000000, "POP1955": 0.000000, "POP1960": 0.000000, "POP1965": 0.000000, "POP1970": 0.000000, "POP1975": 0.000000, "POP1980": 0.000000, "POP1985": 0.000000, "POP1990": 0.000000, "POP1995": 0.000000, "POP2000": 0.000000, "POP2005": 0.000000, "POP2010": 0.000000, "POP2015": 0.000000, "POP2020": 0.000000, "POP2025": 0.000000, "POP2050": 0.000000, "CITYALT": null, "min_zoom": 5.100000, "wikidataid": "Q23436", "wof_id": 101750629.000000, "CAPALT": null, "NAME_EN": "Edinburgh", "NAME_DE": "Edinburgh", "NAME_ES": "Edimburgo", "NAME_FR": "Édimbourg", "NAME_PT": "Edimburgo", "NAME_RU": "Эдинбург", "NAME_ZH": "爱丁堡" }, "geometry": { "type": "Point", "coordinates": [ -3.219090618289499, 55.948327859615347 ] } },
{ "type": "Feature", "properties": { "SCALERANK": 6, "NATSCALE": 30, "LABELRANK": 5, "FEATURECLA": "Populated place", "NAME": "Newcastle", "NAMEPAR": null, "NAMEALT": "Newcastle upon Tyne", "DIFFASCII": 0, "NAMEASCII": "Newcastle", "ADM0CAP": 0.000000, "CAPIN": null, "WORLDCITY": 0.000000, "MEGACITY": 1, "SOV0NAME": "United Kingdom", "SOV_A3": "GBR", "ADM0NAME": "United Kingdom", "ADM0_A3": "GBR", "ADM1NAME": "Tyne and Wear", "ISO_A2": "GB", "NOTE": null, "LATITUDE": 55.000375, "LONGITUDE": -1.599990, "CHANGED": 0.000000, "NAMEDIFF": 0, "DIFFNOTE": null, "POP_MAX": 882000, "POP_MIN": 192382, "POP_OTHER": 660783, "RANK_MAX": 11, "RANK_MIN": 9, "GEONAMEID": 2641673.000000, "MEGANAME": "Newcastle upon Tyne", "LS_NAME": "Newcastle", "LS_MATCH": 1, "CHECKME": 0, "MAX_POP10": 717948.000000, "MAX_POP20": 1134616.000000, "MAX_POP50": 273848.000000, "MAX_POP300": 273848.000000, "MAX_POP310": 0.000000, "MAX_NATSCA": 100.000000, "MIN_AREAKM": 179.000000, "MAX_AREAKM": 479.000000, "MIN_AREAMI": 69.000000, "MAX_AREAMI": 185.000000, "MIN_PERKM": 188.000000, "MAX_PERKM": 374.000000, "MIN_PERMI": 117.000000, "MAX_PERMI": 233.000000, "MIN_BBXMIN": -1.800000, "MAX_BBXMIN": 151.566667, "MIN_BBXMAX": -1.451249, "MAX_BBXMAX": 151.791667, "MIN_BBYMIN": -33.041667, "MAX_BBYMIN": 54.841667, "MIN_BBYMAX": -32.866667, "MAX_BBYMAX": 55.108333, "MEAN_BBXC": 75.048749, "MEAN_BBYC": 11.007107, "COMPARE": 0, "GN_ASCII": "Newcastle upon Tyne", "FEATURE_CL": "P", "FEATURE_CO": "PPL", "ADMIN1_COD": 0.000000, "GN_POP": 192382.000000, "ELEVATION": 0.000000, "GTOPO30": 20.000000, "TIMEZONE": "Europe\/London", "GEONAMESNO": "GeoNames rough area, rough name.", "UN_FID": 521, "UN_ADM0": "United Kingdom", "UN_LAT": 54.960000, "UN_LONG": -1.600000, "POP1950": 909.000000, "POP1955": 921.000000, "POP1960": 934.000000, "POP1965": 913.000000, "POP1970": 886.000000, "POP1975": 838.000000, "POP1980": 790.000000, "POP1985": 825.000000, "POP1990": 877.000000, "POP1995": 883.000000, "POP2000": 880.000000, "POP2005": 880.000000, "POP2010": 882.000000, "POP2015": 887.000000, "POP2020": 898.000000, "POP2025": 908.000000, "POP2050": 918.000000, "CITYALT": null, "min_zoom": 5.100000, "wikidataid": "Q1425428", "wof_id": 101750617.000000, "CAPALT": null, "NAME_EN": "Newcastle upon Tyne", "NAME_DE": "Newcastle upon Tyne", "NAME_ES": "Newcastle upon Tyne", "NAME_FR": "Newcastle upon Tyne", "NAME_PT": "Newcastle upon Tyne", "NAME_RU": "Ньюкасл на Тайне", "NAME_ZH": "泰恩河畔纽卡斯尔" }, "geometry": { "type": "Point", "coordinates": [ -1.601936338549592, 55.002321244266113 ] } },
{ "type": "Feature", "properties": { "SCALERANK": 6, "NATSCALE": 30, "LABELRANK": 5, "FEATURECLA": "Populated place", "NAME": "Liverpool", "NAMEPAR": null, "NAMEALT": null, "DIFFASCII": 0, "NAMEASCII": "Liverpool", "ADM0CAP": 0.000000, "CAPIN": null, "WORLDCITY": 0.000000, "MEGACITY": 1, "SOV0NAME": "United Kingdom", "SOV_A3": "GBR", "ADM0NAME": "United Kingdom", "ADM0_A3": "GBR", "ADM1NAME": "Merseyside", "ISO_A2": "GB", "NOTE": null, "LATITUDE": 53.416002, "LONGITUDE": -2.917998, "CHANGED": 1.000000, "NAMEDIFF": 0, "DIFFNOTE": "Changed scale rank.", "POP_MAX": 811000, "POP_MIN": 468945, "POP_OTHER": 4331, "RANK_MAX": 11, "RANK_MIN": 10, "GEONAMEID": 2644210.000000, "MEGANAME": "Liverpool", "LS_NAME": "Liverpool2", "LS_MATCH": 1, "CHECKME": 0, "MAX_POP10": 1300960.000000, "MAX_POP20": 1305570.000000, "MAX_POP50": 0.000000, "MAX_POP300": 0.000000, "MAX_POP310": 0.000000, "MAX_NATSCA": 20.000000, "MIN_AREAKM": 535.000000, "MAX_AREAKM": 542.000000, "MIN_AREAMI": 206.000000, "MAX_AREAMI": 209.000000, "MIN_PERKM": 392.000000, "MAX_PERKM": 404.000000, "MIN_PERMI": 244.000000, "MAX_PERMI": 251.000000, "MIN_BBXMIN": -3.058333, "MAX_BBXMIN": -3.058333, "MIN_BBXMAX": -2.567378, "MAX_BBXMAX": -2.567378, "MIN_BBYMIN": 53.266667, "MAX_BBYMIN": 53.305614, "MIN_BBYMAX": 53.600000, "MAX_BBYMAX": 53.600000, "MEAN_BBXC": -2.781569, "MEAN_BBYC": 53.443273, "COMPARE": 0, "GN_ASCII": "Liverpool", "FEATURE_CL": "P", "FEATURE_CO": "PPL", "ADMIN1_COD": 0.000000, "GN_POP": 468945.000000, "ELEVATION": 0.000000, "GTOPO30": 5.000000, "TIMEZONE": "Europe\/London", "GEONAMESNO": "GeoNames match with ascii name + lat + long whole numbers.", "UN_FID": 518, "UN_ADM0": "United Kingdom", "UN_LAT": 53.420000, "UN_LONG": -2.970000, "POP1950": 1382.000000, "POP1955": 1383.000000, "POP1960": 1384.000000, "POP1965": 1334.000000, "POP1970": 1276.000000, "POP1975": 1018.000000, "POP1980": 784.000000, "POP1985": 788.000000, "POP1990": 831.000000, "POP1995": 829.000000, "POP2000": 818.000000, "POP2005": 811.000000, "POP2010": 811.000000, "POP2015": 815.000000, "POP2020": 825.000000, "POP2025": 836.000000, "POP2050": 845.000000, "CITYALT": null, "min_zoom": 6.000000, "wikidataid": "Q24826", "wof_id": 101750547.000000, "CAPALT": null, "NAME_EN": "Liverpool", "NAME_DE": "Liverpool", "NAME_ES": "Liverpool", "NAME_FR": "Liverpool", "NAME_PT": "Liverpool", "NAME_RU": "Ливерпуль", "NAME_ZH": "利物浦" }, "geometry": { "type": "Point", "coordinates": [ -2.919943744153841, 53.41794766841349 ] } },
{ "type": "Feature", "properties": { "SCALERANK": 6, "NATSCALE": 30, "LABELRANK": 5, "FEATURECLA": "Admin-0 region capital", "NAME": "Cardiff", "NAMEPAR": null, "NAMEALT": null, "DIFFASCII": 0, "NAMEASCII": "Cardiff", "ADM0CAP": 0.000000, "CAPIN": null, "WORLDCITY": 0.000000, "MEGACITY": 0, "SOV0NAME": "United Kingdom", "SOV_A3": "GBR", "ADM0NAME": "United Kingdom", "ADM0_A3": "GBR", "ADM1NAME": "Cardiff", "ISO_A2": "GB", "NOTE": null, "LATITUDE": 51.499995, "LONGITUDE": -3.225008, "CHANGED": 1.000000, "NAMEDIFF": 0, "DIFFNOTE": "Changed scale rank.", "POP_MAX": 861400, "POP_MIN": 346100, "POP_OTHER": 458831, "RANK_MAX": 11, "RANK_MIN": 10, "GEONAMEID": 2172349.000000, "MEGANAME": null, "LS_NAME": "Cardiff", "LS_MATCH": 1, "CHECKME": 5, "MAX_POP10": 527695.000000, "MAX_POP20": 528178.000000, "MAX_POP50": 0.000000, "MAX_POP300": 0.000000, "MAX_POP310": 0.000000, "MAX_NATSCA": 20.000000, "MIN_AREAKM": 289.000000, "MAX_AREAKM": 290.000000, "MIN_AREAMI": 111.000000, "MAX_AREAMI": 112.000000, "MIN_PERKM": 375.000000, "MAX_PERKM": 381.000000, "MIN_PERMI": 233.000000, "MAX_PERMI": 237.000000, "MIN_BBXMIN": -3.575000, "MAX_BBXMIN": -3.555841, "MIN_BBXMAX": -3.058333, "MAX_BBXMAX": -3.058333, "MIN_BBYMIN": 51.416667, "MAX_BBYMIN": 51.416667, "MIN_BBYMAX": 51.758333, "MAX_BBYMAX": 51.758333, "MEAN_BBXC": -3.307035, "MEAN_BBYC": 51.571972, "COMPARE": 0, "GN_ASCII": "Cardiff", "FEATURE_CL": "P", "FEATURE_CO": "PPL", "ADMIN1_COD": 2.000000, "GN_POP": 2883.000000, "ELEVATION": 0.000000, "GTOPO30": 1.000000, "TIMEZONE": "Australia\/Sydney", "GEONAMESNO": "GeoNames match general.", "UN_FID": 0, "UN_ADM0": null, "UN_LAT": 0.000000, "UN_LONG": 0.000000, "POP1950": 0.000000, "POP1955": 0.000000, "POP1960": 0.000000, "POP1965": 0.000000, "POP1970": 0.000000, "POP1975": 0.000000, "POP1980": 0.000000, "POP1985": 0.000000, "POP1990": 0.000000, "POP1995": 0.000000, "POP2000": 0.000000, "POP2005": 0.000000, "POP2010": 0.000000, "POP2015": 0.000000, "POP2020": 0.000000, "POP2025": 0.000000, "POP2050": 0.000000, "CITYALT": null, "min_zoom": 5.100000, "wikidataid": "Q10690", "wof_id": 101929817.000000, "CAPALT": null, "NAME_EN": "Cardiff", "NAME_DE": "Cardiff", "NAME_ES": "Cardiff", "NAME_FR": "Cardiff", "NAME_PT": "Cardiff", "NAME_RU": "Кардифф", "NAME_ZH": "加的夫" }, "geometry": { "type": "Point", "coordinates": [ -3.225007569786953, 51.499994729714615 ] } },
{ "type": "Feature", "properties": { "SCALERANK": 6, "NATSCALE": 30, "LABELRANK": 5, "FEATURECLA": "Populated place", "NAME": "Leeds", "NAMEPAR": null, "NAMEALT": "West Yorkshire", "DIFFASCII": 0, "NAMEASCII": "Leeds", "ADM0CAP": 0.000000, "CAPIN": null, "WORLDCITY": 0.000000, "MEGACITY": 1, "SOV0NAME": "United Kingdom", "SOV_A3": "GBR", "ADM0NAME": "United Kingdom", "ADM0_A3": "GBR", "ADM1NAME": "West Yorkshire", "ISO_A2": "GB", "NOTE": null, "LATITUDE": 53.830008, "LONGITUDE": -1.580018, "CHANGED": 0.000000, "NAMEDIFF": 0, "DIFFNOTE": null, "POP_MAX": 1529000, "POP_MIN": 455123, "POP_OTHER": 770655, "RANK_MAX": 12, "RANK_MIN": 10, "GEONAMEID": 2644688.000000, "MEGANAME": "West Yorkshire", "LS_NAME": "Leeds", "LS_MATCH": 1, "CHECKME": 0, "MAX_POP10": 810324.000000, "MAX_POP20": 0.000000, "MAX_POP50": 0.000000, "MAX_POP300": 0.000000, "MAX_POP310": 0.000000, "MAX_NATSCA": 10.000000, "MIN_AREAKM": 293.000000, "MAX_AREAKM": 293.000000, "MIN_AREAMI": 113.000000, "MAX_AREAMI": 113.000000, "MIN_PERKM": 231.000000, "MAX_PERKM": 231.000000, "MIN_PERMI": 143.000000, "MAX_PERMI": 143.000000, "MIN_BBXMIN": -1.675585, "MAX_BBXMIN": -1.675585, "MIN_BBXMAX": -1.425000, "MAX_BBXMAX": -1.425000, "MIN_BBYMIN": 53.616667, "MAX_BBYMIN": 53.616667, "MIN_BBYMAX": 53.883333, "MAX_BBYMAX": 53.883333, "MEAN_BBXC": -1.551024, "MEAN_BBYC": 53.760524, "COMPARE": 0, "GN_ASCII": "Leeds", "FEATURE_CL": "P", "FEATURE_CO": "PPL", "ADMIN1_COD": 0.000000, "GN_POP": 455123.000000, "ELEVATION": 0.000000, "GTOPO30": 67.000000, "TIMEZONE": "Europe\/London", "GEONAMESNO": "GeoNames match with ascii name + lat + long whole numbers.", "UN_FID": 522, "UN_ADM0": "United Kingdom", "UN_LAT": 53.790000, "UN_LONG": -1.540000, "POP1950": 1692.000000, "POP1955": 1697.000000, "POP1960": 1703.000000, "POP1965": 1714.000000, "POP1970": 1726.000000, "POP1975": 1618.000000, "POP1980": 1496.000000, "POP1985": 1465.000000, "POP1990": 1449.000000, "POP1995": 1468.000000, "POP2000": 1495.000000, "POP2005": 1521.000000, "POP2010": 1529.000000, "POP2015": 1539.000000, "POP2020": 1552.000000, "POP2025": 1565.000000, "POP2050": 1575.000000, "CITYALT": null, "min_zoom": 5.600000, "wikidataid": "Q39121", "wof_id": 101750579.000000, "CAPALT": null, "NAME_EN": "Leeds", "NAME_DE": "Leeds", "NAME_ES": "Leeds", "NAME_FR": "Leeds", "NAME_PT": "Leeds", "NAME_RU": "Лидс", "NAME_ZH": "利兹" }, "geometry": { "type": "Point", "coordinates": [ -1.581963397468712, 53.831953405719901 ] } },
{ "type": "Feature", "properties": { "SCALERANK": 4, "NATSCALE": 50, "LABELRANK": 5, "FEATURECLA": "Populated place", "NAME": "Manchester", "NAMEPAR": null, "NAMEALT": null, "DIFFASCII": 0, "NAMEASCII": "Manchester", "ADM0CAP": 0.000000, "CAPIN": null, "WORLDCITY": 0.000000, "MEGACITY": 1, "SOV0NAME": "United Kingdom", "SOV_A3": "GBR", "ADM0NAME": "United Kingdom", "ADM0_A3": "GBR", "ADM1NAME": "Manchester", "ISO_A2": "GB", "NOTE": null, "LATITUDE": 53.500415, "LONGITUDE": -2.247987, "CHANGED": 0.000000, "NAMEDIFF": 0, "DIFFNOTE": null, "POP_MAX": 2230000, "POP_MIN": 395515, "POP_OTHER": 142301, "RANK_MAX": 12, "RANK_MIN": 10, "GEONAMEID": 2643123.000000, "MEGANAME": "Manchester", "LS_NAME": "Manchester2", "LS_MATCH": 1, "CHECKME": 0, "MAX_POP10": 2583902.000000, "MAX_POP20": 2583902.000000, "MAX_POP50": 0.000000, "MAX_POP300": 0.000000, "MAX_POP310": 0.000000, "MAX_NATSCA": 20.000000, "MIN_AREAKM": 1052.000000, "MAX_AREAKM": 1052.000000, "MIN_AREAMI": 406.000000, "MAX_AREAMI": 406.000000, "MIN_PERKM": 763.000000, "MAX_PERKM": 763.000000, "MIN_PERMI": 474.000000, "MAX_PERMI": 474.000000, "MIN_BBXMIN": -2.600000, "MAX_BBXMIN": -2.600000, "MIN_BBXMAX": -2.008333, "MAX_BBXMAX": -2.008333, "MIN_BBYMIN": 53.283333, "MAX_BBYMIN": 53.283333, "MIN_BBYMAX": 53.808333, "MAX_BBYMAX": 53.808333, "MEAN_BBXC": -2.294601, "MEAN_BBYC": 53.518239, "COMPARE": 0, "GN_ASCII": "Manchester", "FEATURE_CL": "P", "FEATURE_CO": "PPL", "ADMIN1_COD": 0.000000, "GN_POP": 395515.000000, "ELEVATION": 0.000000, "GTOPO30": 60.000000, "TIMEZONE": "Europe\/London", "GEONAMESNO": "Geonames ascii name + lat.d + long.d matching.", "UN_FID": 520, "UN_ADM0": "United Kingdom", "UN_LAT": 53.470000, "UN_LONG": -2.260000, "POP1950": 2422.000000, "POP1955": 2425.000000, "POP1960": 2427.000000, "POP1965": 2413.000000, "POP1970": 2396.000000, "POP1975": 2370.000000, "POP1980": 2343.000000, "POP1985": 2313.000000, "POP1990": 2282.000000, "POP1995": 2262.000000, "POP2000": 2243.000000, "POP2005": 2230.000000, "POP2010": 2230.000000, "POP2015": 2235.000000, "POP2020": 2246.000000, "POP2025": 2258.000000, "POP2050": 2267.000000, "CITYALT": null, "min_zoom": 5.000000, "wikidataid": "Q18125", "wof_id": 101750525.000000, "CAPALT": null, "NAME_EN": "Manchester", "NAME_DE": "Manchester", "NAME_ES": "Mánchester", "NAME_FR": "Manchester", "NAME_PT": "Manchester", "NAME_RU": "Манчестер", "NAME_ZH": "曼彻斯特" }, "geometry": { "type": "Point", "coordinates": [ -2.249932961273487, 53.502361120562284 ] } },
{ "type": "Feature", "properties": { "SCALERANK": 4, "NATSCALE": 50, "LABELRANK": 5, "FEATURECLA": "Populated place", "NAME": "Birmingham", "NAMEPAR": null, "NAMEALT": null, "DIFFASCII": 0, "NAMEASCII": "Birmingham", "ADM0CAP": 0.000000, "CAPIN": null, "WORLDCITY": 0.000000, "MEGACITY": 1, "SOV0NAME": "United Kingdom", "SOV_A3": "GBR", "ADM0NAME": "United Kingdom", "ADM0_A3": "GBR", "ADM1NAME": "West Midlands", "ISO_A2": "GB", "NOTE": null, "LATITUDE": 52.474974, "LONGITUDE": -1.919997, "CHANGED": 0.000000, "NAMEDIFF": 0, "DIFFNOTE": null, "POP_MAX": 2285000, "POP_MIN": 984333, "POP_OTHER": 631279, "RANK_MAX": 12, "RANK_MIN": 11, "GEONAMEID": 2655603.000000, "MEGANAME": "Birmingham", "LS_NAME": "Birmingham2", "LS_MATCH": 1, "CHECKME": 0, "MAX_POP10": 2331021.000000, "MAX_POP20": 2331021.000000, "MAX_POP50": 2331630.000000, "MAX_POP300": 0.000000, "MAX_POP310": 0.000000, "MAX_NATSCA": 50.000000, "MIN_AREAKM": 838.000000, "MAX_AREAKM": 842.000000, "MIN_AREAMI": 324.000000, "MAX_AREAMI": 325.000000, "MIN_PERKM": 433.000000, "MAX_PERKM": 438.000000, "MIN_PERMI": 269.000000, "MAX_PERMI": 272.000000, "MIN_BBXMIN": -2.216667, "MAX_BBXMIN": -2.216667, "MIN_BBXMAX": -1.698778, "MAX_BBXMAX": -1.683333, "MIN_BBYMIN": 52.358333, "MAX_BBYMIN": 52.358333, "MIN_BBYMAX": 52.733333, "MAX_BBYMAX": 52.733333, "MEAN_BBXC": -1.964565, "MEAN_BBYC": 52.526389, "COMPARE": 0, "GN_ASCII": "Birmingham", "FEATURE_CL": "P", "FEATURE_CO": "PPL", "ADMIN1_COD": 0.000000, "GN_POP": 984333.000000, "ELEVATION": 0.000000, "GTOPO30": 140.000000, "TIMEZONE": "Europe\/London", "GEONAMESNO": "Geonames ascii name + lat.d + long.d matching.", "UN_FID": 516, "UN_ADM0": "United Kingdom", "UN_LAT": 52.490000, "UN_LONG": -1.860000, "POP1950": 2229.000000, "POP1955": 2283.000000, "POP1960": 2338.000000, "POP1965": 2357.000000, "POP1970": 2370.000000, "POP1975": 2365.000000, "POP1980": 2357.000000, "POP1985": 2330.000000, "POP1990": 2301.000000, "POP1995": 2291.000000, "POP2000": 2285.000000, "POP2005": 2283.000000, "POP2010": 2285.000000, "POP2015": 2291.000000, "POP2020": 2303.000000, "POP2025": 2315.000000, "POP2050": 2323.000000, "CITYALT": null, "min_zoom": 5.000000, "wikidataid": "Q2256", "wof_id": 1141909171.000000, "CAPALT": null, "NAME_EN": "Birmingham", "NAME_DE": "Birmingham", "NAME_ES": "Birmingham", "NAME_FR": "Birmingham", "NAME_PT": "Birmingham", "NAME_RU": "Бирмингем", "NAME_ZH": "伯明翰" }, "geometry": { "type": "Point", "coordinates": [ -1.921942645517049, 52.476919836378443 ] } },
{ "type": "Feature", "properties": { "SCALERANK": 4, "NATSCALE": 50, "LABELRANK": 5, "FEATURECLA": "Admin-0 region capital", "NAME": "Belfast", "NAMEPAR": null, "NAMEALT": null, "DIFFASCII": 0, "NAMEASCII": "Belfast", "ADM0CAP": 0.000000, "CAPIN": null, "WORLDCITY": 0.000000, "MEGACITY": 0, "SOV0NAME": "United Kingdom", "SOV_A3": "GBR", "ADM0NAME": "United Kingdom", "ADM0_A3": "GBR", "ADM1NAME": "Belfast", "ISO_A2": "GB", "NOTE": null, "LATITUDE": 54.600012, "LONGITUDE": -5.960034, "CHANGED": 0.000000, "NAMEDIFF": 0, "DIFFNOTE": null, "POP_MAX": 450406, "POP_MIN": 274770, "POP_OTHER": 418064, "RANK_MAX": 10, "RANK_MIN": 10, "GEONAMEID": 2655984.000000, "MEGANAME": null, "LS_NAME": "Belfast", "LS_MATCH": 1, "CHECKME": 0, "MAX_POP10": 450406.000000, "MAX_POP20": 450406.000000, "MAX_POP50": 450406.000000, "MAX_POP300": 0.000000, "MAX_POP310": 0.000000, "MAX_NATSCA": 50.000000, "MIN_AREAKM": 192.000000, "MAX_AREAKM": 192.000000, "MIN_AREAMI": 74.000000, "MAX_AREAMI": 74.000000, "MIN_PERKM": 204.000000, "MAX_PERKM": 204.000000, "MIN_PERMI": 127.000000, "MAX_PERMI": 127.000000, "MIN_BBXMIN": -6.125000, "MAX_BBXMIN": -6.125000, "MIN_BBXMAX": -5.758333, "MAX_BBXMAX": -5.758333, "MIN_BBYMIN": 54.458333, "MAX_BBYMIN": 54.458333, "MIN_BBYMAX": 54.708333, "MAX_BBYMAX": 54.708333, "MEAN_BBXC": -5.948755, "MEAN_BBYC": 54.593128, "COMPARE": 0, "GN_ASCII": "Belfast", "FEATURE_CL": "P", "FEATURE_CO": "PPLA", "ADMIN1_COD": 0.000000, "GN_POP": 274770.000000, "ELEVATION": 0.000000, "GTOPO30": 9.000000, "TIMEZONE": "Europe\/London", "GEONAMESNO": "GeoNames match general.", "UN_FID": 0, "UN_ADM0": null, "UN_LAT": 0.000000, "UN_LONG": 0.000000, "POP1950": 0.000000, "POP1955": 0.000000, "POP1960": 0.000000, "POP1965": 0.000000, "POP1970": 0.000000, "POP1975": 0.000000, "POP1980": 0.000000, "POP1985": 0.000000, "POP1990": 0.000000, "POP1995": 0.000000, "POP2000": 0.000000, "POP2005": 0.000000, "POP2010": 0.000000, "POP2015": 0.000000, "POP2020": 0.000000, "POP2025": 0.000000, "POP2050": 0.000000, "CITYALT": null, "min_zoom": 5.000000, "wikidataid": "Q10686", "wof_id": 101751931.000000, "CAPALT": null, "NAME_EN": "Belfast", "NAME_DE": "Belfast", "NAME_ES": "Belfast", "NAME_FR": "Belfast", "NAME_PT": "Belfast", "NAME_RU": "Белфаст", "NAME_ZH": "贝尔法斯特" }, "geometry": { "type": "Point", "coordinates": [ -5.960034425266599, 54.60001222647179 ] } },
{ "type": "Feature", "properties": { "SCALERANK": 3, "NATSCALE": 110, "LABELRANK": 5, "FEATURECLA": "Populated place", "NAME": "Glasgow", "NAMEPAR": null, "NAMEALT": null, "DIFFASCII": 0, "NAMEASCII": "Glasgow", "ADM0CAP": 0.000000, "CAPIN": null, "WORLDCITY": 0.000000, "MEGACITY": 1, "SOV0NAME": "United Kingdom", "SOV_A3": "GBR", "ADM0NAME": "United Kingdom", "ADM0_A3": "GBR", "ADM1NAME": "Glasgow", "ISO_A2": "GB", "NOTE": null, "LATITUDE": 55.874405, "LONGITUDE": -4.250707, "CHANGED": 0.000000, "NAMEDIFF": 0, "DIFFNOTE": null, "POP_MAX": 1160000, "POP_MIN": 610268, "POP_OTHER": 3240, "RANK_MAX": 12, "RANK_MIN": 11, "GEONAMEID": 2648579.000000, "MEGANAME": "Glasgow", "LS_NAME": "Glasgow2", "LS_MATCH": 1, "CHECKME": 2, "MAX_POP10": 1216706.000000, "MAX_POP20": 1233551.000000, "MAX_POP50": 1233551.000000, "MAX_POP300": 1233551.000000, "MAX_POP310": 0.000000, "MAX_NATSCA": 100.000000, "MIN_AREAKM": 468.000000, "MAX_AREAKM": 483.000000, "MIN_AREAMI": 181.000000, "MAX_AREAMI": 187.000000, "MIN_PERKM": 377.000000, "MAX_PERKM": 408.000000, "MIN_PERMI": 234.000000, "MAX_PERMI": 254.000000, "MIN_BBXMIN": -4.558333, "MAX_BBXMIN": -4.510663, "MIN_BBXMAX": -3.858333, "MAX_BBXMAX": -3.858333, "MIN_BBYMIN": 55.733333, "MAX_BBYMIN": 55.733333, "MIN_BBYMAX": 55.958333, "MAX_BBYMAX": 55.958333, "MEAN_BBXC": -4.225184, "MEAN_BBYC": 55.843904, "COMPARE": 0, "GN_ASCII": "Glasgow", "FEATURE_CL": "P", "FEATURE_CO": "PPL", "ADMIN1_COD": 0.000000, "GN_POP": 610268.000000, "ELEVATION": 0.000000, "GTOPO30": 67.000000, "TIMEZONE": "Europe\/London", "GEONAMESNO": "Geonames ascii name + lat.d + long.d matching.", "UN_FID": 517, "UN_ADM0": "United Kingdom", "UN_LAT": 55.860000, "UN_LONG": -4.260000, "POP1950": 1755.000000, "POP1955": 1777.000000, "POP1960": 1798.000000, "POP1965": 1770.000000, "POP1970": 1734.000000, "POP1975": 1601.000000, "POP1980": 1461.000000, "POP1985": 1334.000000, "POP1990": 1217.000000, "POP1995": 1186.000000, "POP2000": 1171.000000, "POP2005": 1160.000000, "POP2010": 1160.000000, "POP2015": 1164.000000, "POP2020": 1175.000000, "POP2025": 1187.000000, "POP2050": 1197.000000, "CITYALT": null, "min_zoom": 4.000000, "wikidataid": "Q4093", "wof_id": 101750621.000000, "CAPALT": null, "NAME_EN": "Glasgow", "NAME_DE": "Glasgow", "NAME_ES": "Glasgow", "NAME_FR": "Glasgow", "NAME_PT": "Glasgow", "NAME_RU": "Глазго", "NAME_ZH": "格拉斯哥" }, "geometry": { "type": "Point", "coordinates": [ -4.252653094744971, 55.876350581834743 ] } },
{ "type": "Feature", "properties": { "SCALERANK": 0, "NATSCALE": 600, "LABELRANK": 5, "FEATURECLA": "Admin-0 capital", "NAME": "London", "NAMEPAR": null, "NAMEALT": null, "DIFFASCII": 0, "NAMEASCII": "London", "ADM0CAP": 1.000000, "CAPIN": null, "WORLDCITY": 1.000000, "MEGACITY": 1, "SOV0NAME": "United Kingdom", "SOV_A3": "GBR", "ADM0NAME": "United Kingdom", "ADM0_A3": "GBR", "ADM1NAME": "Westminster", "ISO_A2": "GB", "NOTE": null, "LATITUDE": 51.499995, "LONGITUDE": -0.116722, "CHANGED": 0.000000, "NAMEDIFF": 0, "DIFFNOTE": null, "POP_MAX": 8567000, "POP_MIN": 7421209, "POP_OTHER": 326670, "RANK_MAX": 13, "RANK_MIN": 13, "GEONAMEID": 2643743.000000, "MEGANAME": "London", "LS_NAME": "London2", "LS_MATCH": 1, "CHECKME": 5, "MAX_POP10": 7721282.000000, "MAX_POP20": 8370578.000000, "MAX_POP50": 10011551.000000, "MAX_POP300": 10011551.000000, "MAX_POP310": 10011551.000000, "MAX_NATSCA": 300.000000, "MIN_AREAKM": 1914.000000, "MAX_AREAKM": 3198.000000, "MIN_AREAMI": 739.000000, "MAX_AREAMI": 1235.000000, "MIN_PERKM": 994.000000, "MAX_PERKM": 2440.000000, "MIN_PERMI": 618.000000, "MAX_PERMI": 1516.000000, "MIN_BBXMIN": -1.091667, "MAX_BBXMIN": -0.546866, "MIN_BBXMAX": 0.307108, "MAX_BBXMAX": 0.816667, "MIN_BBYMIN": 51.133333, "MAX_BBYMIN": 51.208333, "MIN_BBYMAX": 51.825000, "MAX_BBYMAX": 51.825000, "MEAN_BBXC": -0.169651, "MEAN_BBYC": 51.489624, "COMPARE": 0, "GN_ASCII": "London", "FEATURE_CL": "P", "FEATURE_CO": "PPLC", "ADMIN1_COD": 0.000000, "GN_POP": 7421209.000000, "ELEVATION": 0.000000, "GTOPO30": 21.000000, "TIMEZONE": "Europe\/London", "GEONAMESNO": "GeoNames match general.", "UN_FID": 519, "UN_ADM0": "United Kingdom", "UN_LAT": 51.480000, "UN_LONG": -0.170000, "POP1950": 8361.000000, "POP1955": 8278.000000, "POP1960": 8196.000000, "POP1965": 7869.000000, "POP1970": 7509.000000, "POP1975": 7546.000000, "POP1980": 7660.000000, "POP1985": 7667.000000, "POP1990": 7654.000000, "POP1995": 7908.000000, "POP2000": 8225.000000, "POP2005": 8505.000000, "POP2010": 8567.000000, "POP2015": 8607.000000, "POP2020": 8618.000000, "POP2025": 8618.000000, "POP2050": 8618.000000, "CITYALT": null, "min_zoom": 1.700000, "wikidataid": "Q84", "wof_id": 101750367.000000, "CAPALT": null, "NAME_EN": "London", "NAME_DE": "London", "NAME_ES": "Londres", "NAME_FR": "Londres", "NAME_PT": "Londres", "NAME_RU": "Лондон", "NAME_ZH": "倫敦" }, "geometry": { "type": "Point", "coordinates": [ -0.118667702475932, 51.5019405883275 ] } }
]
}`))

func spike(reader io.Reader) ([]byte, error) {
	return asTopojson(reader);
}

func asTopojson(reader io.Reader) ([]byte, error) {
	bytes, err := ioutil.ReadAll(reader)
	if err != nil {
		log.Error(err, log.Data{"request_body": string(bytes)})
		return nil, err
	}
	log.Debug("Render Request: ", log.Data{"request_body": string(bytes)})

	input, err := topojson.UnmarshalTopology(bytes)

	if err != nil {
		log.Error(err, log.Data{"request_body": string(bytes)})
		return nil, err
	}

	geoJSON := input.ToGeoJSON()

	json, _ := geoJSON.MarshalJSON()
	println()
	println(string(json))
	println()

	svg := geojson2svg.New()
	svg.AppendFeatureCollection(geoJSON)

	output := svg.Draw(497, 600)

	return []byte(output), nil;
}

func asMercator(reader io.Reader) ([]byte, error) {
	bytes, err := ioutil.ReadAll(reader)
	if err != nil {
		log.Error(err, log.Data{"request_body": string(bytes)})
		return nil, err
	}
	log.Debug("Render Request: ", log.Data{"request_body": string(bytes)})

	input, err := topojson.UnmarshalTopology(bytes)

	if err != nil {
		log.Error(err, log.Data{"request_body": string(bytes)})
		return nil, err
	}

	geoJSON := input.ToGeoJSON()

	//json, _ := geoJSON.MarshalJSON()
	//println()
	//println(string(json))
	//println()

	svg := geojson2svg.New()
	svg.AppendFeatureCollection(placesJson)
	svg.AppendFeatureCollection(geoJSON)

	width := 400.0
	height := svg.GetHeightForWidth(width, geojson2svg.MercatorProjection)
	output := svg.DrawWithProjection(width, height, geojson2svg.MercatorProjection)

	return []byte(output), nil;
}

